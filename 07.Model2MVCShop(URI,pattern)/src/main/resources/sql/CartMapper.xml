<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper
		PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="CartMapper">
 	
 	
	<resultMap id="cartSelectMap" type="cart">
		<result property="cartNo" 			column="cart_no" 		jdbcType="NUMERIC" />
		<result property="cartProd.prodNo" 			column="prod_no" 		jdbcType="NUMERIC" />
		<result property="cartUserId" 				column="user_id" 					jdbcType="VARCHAR" />
		<result property="cartAmount"		column="cart_amount"		jdbcType="NUMERIC"/>
		<result property="cartCode"			column="cart_code"		jdbcType="CHAR"/>
	</resultMap>
	
	<insert id="addCart"		parameterType="cart">
		insert
		into cart (cart_no, prod_no, user_id, cart_amount, cart_code)
		values (seq_transaction_tran_no.nextval,#{cartProdNo},#{cartUserId},#{cartAmount},#{cartCode})
	</insert>
	
	<delete id="deleteCart" 	parameterType="cart">
		delete 
		from transaction 
		where PROD_NO=#{cartProdNo} and user_id=#{cartUserId} and cart_code='1'
	</delete>
	
	<select  id="getCartList"  parameterType="map" 	resultMap="cartSelectMap">
		SELECT *
	  	FROM (	SELECT inner_table.* , ROWNUM AS row_seq
						FROM		(	SELECT cart_no, prod_no, user_id, cart_amount, cart_code
	  								from cart
	  								where user_id=#{userCartId} 
											order by cart_no) inner_table
						WHERE ROWNUM &lt;= #{search.endRowNum} )
		WHERE row_seq BETWEEN #{search.startRowNum} AND #{search.endRowNum} 
	 </select>
	
	<select id="getTotalCount"	parameterType="string"		resultType="int">
		SELECT COUNT(*)
	  		FROM(	SELECT cart_no, prod_no, user_id, cart_amount, cart_code
	  								from cart
	  								where user_id=#{value})countTable
	</select>
	
</mapper>